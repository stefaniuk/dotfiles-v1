#!/bin/bash

# define help
help=$(cat <<HEREDOC

    DESCRIPTION: Show documentation entries from the ~/doc directory.

    PARAMETERS:
        \$1     Directory name from within ~/doc
        \$2     File name
        \$3     File type, optional
HEREDOC
)

# print help
if [ "$1" == "-h" ] || [ "$1" == "--help" ]; then
    echo -e "${help}\n"
    exit 0
fi

# print list
if [ -n "$(echo "$*" | grep -o -- "-l")" ] || [ -n "$(echo "$*" | grep -o -- "--list")" ]; then
    if [ $# -gt 1 ]; then
        ls -1 ~/doc/*${1}* | \
            sed 's/\.[^.]*$//g' | \
            sort | \
            uniq
    else
        ls -1 ~/doc
    fi
    exit 0
fi

# get parameters
dir_name="$1"
file_name="$2"
file_type="${3:-*}"

# case-insensitive globbing
shopt -s nocaseglob

for dir in $(ls ~/doc | grep $dir_name 2> /dev/null); do
    for file in $(ls -1 ~/doc/$dir/*${file_name}*.*${file_type}* 2> /dev/null); do

        # handle markdown
        if [ "${file##*.}" == "md" ]; then
            echo
            cat $file | \
                sed "s/^## /`printf "${bold}${white}"`## /g" | \
                sed "s/^#### /`printf "${blue}"`#### /g" | \
                perl -p -e "s/\n/${reset}\n/"
            echo

        # handle documents
        elif [[ "${file##*.}" =~ ^(pdf) ]]; then
            which open > /dev/null 2>&1 && \
                open $file > /dev/null 2>&1 # Mac OS X
            which gnome-open > /dev/null 2>&1 && \
                gnome-open $file > /dev/null 2>&1 # Ubuntu

        # handle images
        elif [[ "${file##*.}" =~ ^(jpeg|png|svg) ]]; then
            which open > /dev/null 2>&1 && \
                open $file > /dev/null 2>&1 # Mac OS X
            which eog > /dev/null 2>&1 && \
                eog $file > /dev/null 2>&1 # Ubuntu

        # handle source code
        else
            echo
            which pygmentize > /dev/null 2>&1 && \
                pygmentize -g $file || cat $file
            echo
        fi

    done
done

exit 0
